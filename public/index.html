<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Registro de Votación</title>
</head>
<body>
  <h2>Agregar Voto Manual</h2>
  <form id="votoForm">
    <input type="text" name="rut" placeholder="RUT" required><br>
    <select name="carrera" required>
      <option value="">Seleccione carrera</option>
      <option value="Naval">Naval</option>
      <option value="Industrial">Industrial</option>
      <option value="Electronica">Electrónica</option>
      <option value="Construccion Civil">Construcción Civil</option>
      <option value="Obras Civiles">Obras Civiles</option>
      <option value="Mecanica">Mecánica</option>
      <option value="Informatica">Informática</option>
      <option value="Bachillerato">Bachillerato</option>
      <option value="Bachillerato">Acustica</option>
    </select><br>
    <select name="opcion" required>
      <option value="Si">Paro</option>
      <option value="No">Suspensión de clases / Nulo</option>
      <option value=""></option>
    </select><br>
    <input type="password" name="password" placeholder="Contraseña" required><br>
    <button type="submit">Agregar Voto</button>
  </form>

  <h2>Ver Resultados</h2>
  <form id="resultadosForm">
    <input type="password" name="password" placeholder="Contraseña" required>
    <button type="submit">Mostrar Resultados</button>
  </form>

  <div id="resultados"></div>

  <script>
    document.getElementById("votoForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const data = Object.fromEntries(formData.entries());

      const res = await fetch("/agregar-voto", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      const text = await res.text();
      alert(text);
    });

    document.getElementById("resultadosForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const password = e.target.password.value;

      const res = await fetch("/resultados", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ password }),
      });

      if (!res.ok) {
        alert("Contraseña incorrecta");
        return;
      }

      const data = await res.json();
      const div = document.getElementById("resultados");
      div.innerHTML = `<h3>Total votos: ${data.total}</h3>
        <p>Paro: ${data.totalSi}</p>
        <p>No: ${data.totalNo}</p>
        <p>: ${data.total}</p>
        <h4>Por Carrera:</h4>`;

      for (const carrera in data.resumen) {
        const c = data.resumen[carrera];
        const total = c.Si + c.No + c.;
        div.innerHTML += `<p><strong>${carrera}</strong>: Paro (${c.Si}), No (${c.No}),  (${c.}), Total: ${total}</p>`;
      }
    });
  </script>
</body>
</html>
