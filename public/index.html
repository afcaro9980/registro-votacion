
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registro de Votación</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container mt-5 p-4 bg-white rounded shadow">
    <h2 class="mb-4">Registro de Votación</h2>

    <h4>Agregar voto manualmente</h4>
    <form id="form-voto">
        <input class="form-control mb-2" name="password" placeholder="Ingrese contraseña" required>
        <input class="form-control mb-2" name="rut" placeholder="Ingrese RUT del votante" required>
        <select class="form-select mb-2" name="carrera" required>
            <option>Naval</option>
            <option>Industrial</option>
            <option>Electronica</option>
            <option>Construccion Civil</option>
            <option>Obras Civiles</option>
            <option>Mecanica</option>
            <option>Informatica</option>
            <option>Bachillerato</option>
        </select>
        <label>Opción:</label><br>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="opcion" value="Si" required> Sí
        </div>
        <div class="form-check">
            <input class="form-check-input" type="radio" name="opcion" value="No"> No
        </div>
        <div class="form-check mb-3">
            <input class="form-check-input" type="radio" name="opcion" value="Nulo"> Nulo
        </div>
        <button class="btn btn-primary" type="submit">Agregar voto</button>
    </form>

    <hr>

    <h4>Ver Resultados</h4>
    <form id="form-resultados">
        <input class="form-control mb-2" name="password" placeholder="Ingrese contraseña" required>
        <button class="btn btn-success" type="submit">Mostrar Resultados</button>
    </form>

    <div class="mt-4" id="resultados"></div>
</div>

<script>
document.getElementById('form-voto').onsubmit = async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = new URLSearchParams(new FormData(form));
    const res = await fetch('/agregar-voto', {
        method: 'POST',
        body: data
    });
    const msg = await res.text();
    alert(msg);
    form.reset();
};

document.getElementById('form-resultados').onsubmit = async (e) => {
    e.preventDefault();
    const form = e.target;
    const data = new URLSearchParams(new FormData(form));
    const res = await fetch('/resultados', {
        method: 'POST',
        body: data
    });
    const resultados = await res.json();
    let html = '<h5>Resultados por carrera:</h5>';
    for (const carrera in resultados) {
        const r = resultados[carrera];
        html += `<strong>${carrera}</strong>: Sí: ${r.Si}, No: ${r.No}, Nulo: ${r.Nulo}<br>`;
    }
    document.getElementById('resultados').innerHTML = html;
};
</script>
</body>
</html>
